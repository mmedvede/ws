#! /usr/bin/env bash
# Generate environment loader that can be used by distributed ROS launch.

set -e
set -u

# TODO .roswsrc is hardcoded
# The generated script is used both to embed into workspace/initialize script
# and inside ws-switch for unsupported workspaces.

get_env_loader(){
echo -n '#!/bin/sh
# ROS ENVIRONMENT LOADER FOR DISTRIBUTED ROSLAUNCH
# THIS IS A FILE AUTO-GENERATED BY WORKSPACE/INITIALIZE OR WS
# IT IS NOT A PART OF STANDARD ROS
# IT IS UNLIKELY YOU WANT TO EDIT THIS FILE BY HAND

__this_dir=$(dirname $0)
unset ROS_WORKSPACE
. $__this_dir/.roswsrc

if [ -z "$ROS_WORKSPACE" ]; then
  echo "Error: $__this_dir/.roswsrc has to export ROS_WORKSPACE" 1>&2
  exit 1
fi

if [ $# -eq 0 ] ; then
  /bin/echo "Entering environment at $ROS_WORKSPACE"
  . $ROS_WORKSPACE/setup.sh
  $SHELL
  /bin/echo "Exiting build environment at $ROS_WORKSPACE"
else
  . $ROS_WORKSPACE/setup.sh
  exec "$@"
fi'
}

get_env_loader
